
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>File Upload Vulnerablity</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="ce2c85b5-a7c0-4765-808f-cc854ba85dbe" class="page sans"><header><h1 class="page-title">File Upload Vulnerablity</h1><table class="properties"><tbody><tr class="property-row property-row-created_time"><th><span class="icon property-icon"><svg viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCreatedAt"><path d="M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.6738 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.54102 8.91211H7.99316C8.30078 8.91211 8.54004 8.67285 8.54004 8.37207V3.8877C8.54004 3.58691 8.30078 3.34766 7.99316 3.34766C7.69238 3.34766 7.45312 3.58691 7.45312 3.8877V7.83203H4.54102C4.2334 7.83203 4.00098 8.06445 4.00098 8.37207C4.00098 8.67285 4.2334 8.91211 4.54102 8.91211Z"></path></svg></span>Created</th><td><time>@May 16, 2023 11:59 PM</time></td></tr></tbody></table></header><div class="page-body"><h1 id="542743d3-40b6-4ef0-8d1e-8d3432698fd4" class="">File Upload Vulnerability</h1><ul id="380c634d-233b-4ae7-b4a7-76b92b8491c2" class="bulleted-list"><li style="list-style-type:disc">Favorable condition is POST request</li></ul><h3 id="92cf87ce-66a9-4486-a89f-22292ebb774e" class="">What?</h3><ul id="d2dc7e2a-24c4-4b72-a12c-0d6b3da98982" class="bulleted-list"><li style="list-style-type:disc">File upload vulnerabilities are when a web server allows users to upload files to its filesystem without sufficiently validating things like their name, type, contents, or size. Failing to properly enforce restrictions on these could mean that even a basic image upload function can be used to upload arbitrary and potentially dangerous files instead. This could even include server-side script files that enable remote code execution.</li></ul><ul id="cc17e745-8dfc-4099-aba8-84eb3a3691da" class="bulleted-list"><li style="list-style-type:disc">In some cases, the act of uploading the file is in itself enough to cause damage. Other attacks may involve a follow-up HTTP request for the file, typically to trigger its execution by the server.</li></ul><h3 id="c3eb83e5-bbbe-4293-ab3d-38700bae9c46" class="">How?</h3><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3">File upload vulnerabilities can arise due to the following reasons:</summary><div class="indented"><ol type="1" id="5d51f1fa-5dfb-420b-99cd-4280d8881502" class="numbered-list" start="1"><li>Inadequate validation: Developers may implement flawed or easily bypassed validation measures when allowing users to upload files. They might try to blacklist dangerous file types but overlook parsing discrepancies with file extensions, or unintentionally exclude obscure but still harmful file types.</li></ol><ol type="1" id="62434456-4f27-455b-914b-51907b7a0223" class="numbered-list" start="2"><li>Manipulation of file properties: Websites may attempt to verify file types by checking properties that can be manipulated by attackers using tools like Burp Proxy or Repeater. This allows attackers to deceive the system and upload malicious files.</li></ol><ol type="1" id="95ed4130-41a1-4f81-b9b7-c57f8414a784" class="numbered-list" start="3"><li>Inconsistent validation measures: Validation measures may be applied inconsistently across the website&#x27;s network of hosts and directories. This inconsistency creates discrepancies that can be exploited by attackers.</li></ol></div></details><h3 id="46d27dcf-7923-435c-8d52-9dc14588646f" class="">Impact?</h3><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3">What could be the possible impact of this vulnerability</summary><div class="indented"><ul id="6b8b7e96-2ee8-43a2-b624-544e842359b1" class="bulleted-list"><li style="list-style-type:disc">It depends on two factors<ul id="2a0a8f53-2bce-45ef-943b-bece6bc0eaa0" class="bulleted-list"><li style="list-style-type:circle">Validating the property of the file like size, type,content and so on</li></ul><ul id="9f347be1-6893-4534-8ccc-43fc4614aea1" class="bulleted-list"><li style="list-style-type:circle">Restriction being implemented once the file is uploadee</li></ul></li></ul><ul id="9bba8e1b-2f07-49bc-a24a-d2c498d72f2f" class="bulleted-list"><li style="list-style-type:disc">Worst case scenario, validation is not being set properly which result to upload the code shell files which furhter execute by the server.</li></ul><ul id="86b35827-cceb-4f82-a83d-bdf5d2945696" class="bulleted-list"><li style="list-style-type:disc">In this case, an attacker could potentially upload a server-side code file that functions as a web shell, effectively granting them full control over the server.</li></ul><p id="ad9ee9a7-d2d5-49ff-b11f-96f92476d0be" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3">Request handling for files</summary><div class="indented"><p id="b1c31458-92e1-4afd-b9cd-2f3b5748d178" class="">Handling static files:</p><ul id="4dda5e08-fdb6-44a6-9b41-8bbfb4127190" class="bulleted-list"><li style="list-style-type:disc">Server parses request path to identify file extension.</li></ul><ul id="c6ed1a0d-7b96-4d81-a7de-a96585c2adf4" class="bulleted-list"><li style="list-style-type:disc">File extension determines file type using preconfigured mappings.</li></ul><ul id="bd23359d-ed33-4445-b30e-a86f35f8d177" class="bulleted-list"><li style="list-style-type:disc">Actions depend on file type and server configuration.</li></ul><ul id="f4c572bb-8690-4310-8faf-f735946ce045" class="bulleted-list"><li style="list-style-type:disc">For non-executable file types:<ul id="82ce6678-6bcc-4855-b67f-305e42ea4fb2" class="bulleted-list"><li style="list-style-type:circle">Server sends file contents in HTTP response.</li></ul></li></ul><ul id="74e20208-c7a3-432a-b81d-309142e1506c" class="bulleted-list"><li style="list-style-type:disc">For executable file types:<ul id="ea8ea5dc-af6c-4f52-9b7c-8d473a519070" class="bulleted-list"><li style="list-style-type:circle">If server configured to execute, it assigns variables based on headers and parameters in request, runs the script, and sends output in HTTP response.</li></ul><ul id="ccdec587-a44f-4277-a9cb-ca180c90abca" class="bulleted-list"><li style="list-style-type:circle">If server not configured to execute, it may respond with an error.</li></ul><ul id="2350507f-1e1e-4b7d-8d19-d70f63662d70" class="bulleted-list"><li style="list-style-type:circle">In some cases, file contents may still be served as plain text, leading to potential information disclosure. Example in our learning materials.</li></ul><blockquote id="3efaab49-a4b0-4fc6-a09a-553856a9523e" class="">The <code>Content-Type</code> response header may 
provide clues as to what kind of file the server thinks it has served. 
If this header hasn&#x27;t been explicitly set by the application code, it 
normally contains the result of the file extension/MIME type mapping.</blockquote></li></ul><p id="83a0af10-74f3-487e-8cba-9860e5099cdd" class="">
</p></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3"><strong>How to exploit Web-Application with File Upload vulnerability</strong></summary><div class="indented"><ul id="6bdbc5db-525a-46d5-9e2c-4270f6aa918b" class="toggle"><li><details open=""><summary><strong>By Unrestricted File upload to deploy web shell</strong></summary><ul id="ddb260f7-dc4f-4f35-bbc8-e7966a79b789" class="bulleted-list"><li style="list-style-type:disc">Web Shell:<ul id="14918c0b-c582-46c5-a18b-885dd99560ff" class="bulleted-list"><li style="list-style-type:circle">Worst scenario: Website allows upload of server-side scripts (PHP, Java, Python) and executes them as code.</li></ul><ul id="14066091-d7ca-4587-9232-7078c5031b8c" class="bulleted-list"><li style="list-style-type:circle">Web shell: Malicious script enabling execution of arbitrary commands on remote web server via HTTP requests.</li></ul><ul id="995efc36-d1d6-4093-8cb7-e511e777e280" class="bulleted-list"><li style="list-style-type:circle">Successful web shell upload grants full control over server.</li></ul><ul id="69b47f11-af7b-429d-a673-7941f72d317d" class="bulleted-list"><li style="list-style-type:circle">Capabilities include reading/writing files, exfiltrating data, and launching attacks on internal/external servers.</li></ul><ul id="9f2538a8-9617-439b-b450-ccab4738dbe4" class="bulleted-list"><li style="list-style-type:circle">Example: PHP one-liner to read arbitrary files from server&#x27;s filesystem.</li></ul><pre id="b054b458-43ce-4eba-8fa0-72f32303fa16" class="code"><code>&lt;?php echo file_get_contents(&#x27;/path/to/target/file&#x27;); ?&gt;</code></pre><ul id="e1353ba1-2584-47ba-9b69-4536430d9629" class="bulleted-list"><li style="list-style-type:circle">Once uploaded, sending a request for this malicious file will return the target file&#x27;s contents in the response.</li></ul><p id="0e1df417-5f86-4af8-98e0-d90878860939" class="">A more versatile web shell may look something like this:</p><pre id="bb2c794e-a041-4b41-871a-87cd3e72c72c" class="code code-wrap"><code>&lt;?php echo system($_GET[&#x27;command&#x27;]); ?&gt;</code></pre><p id="02803936-fd92-4706-bf4a-f98a116a2c20" class="">This script enables you to pass an arbitrary system command via a query parameter as follows:</p><pre id="db9d6c15-8c2c-4518-b4b8-844f9d0723cf" class="code code-wrap"><code>GET /example/exploit.php?command=id HTTP/1.1</code></pre></li></ul><p id="c6dd9221-9109-48b7-9d52-7ad4e8b835cb" class="">+++++++++++++++++++++++++++Practical++++++++++++++++++++++++++</p><h3 id="f28e03dc-f937-4580-b595-342b366835f7" class="">Steps to check</h3><ul id="35c0ba89-bfb4-4f24-8785-440a0b348113" class="bulleted-list"><li style="list-style-type:disc">check for the upload functionality</li></ul><ul id="172a8ef5-d1b7-4db2-95c0-1794a37472af" class="bulleted-list"><li style="list-style-type:disc">Upload and a file and intercept the request</li></ul><ul id="1af7f027-f2ed-486f-9628-84841552ea28" class="bulleted-list"><li style="list-style-type:disc">The main method would be POST since we are uploadng the file in database</li></ul><ul id="9e4423e8-c2d4-44f9-9b45-dbdc89ba9f0a" class="bulleted-list"><li style="list-style-type:disc">Check in the proxy history tab for the GET request, as once the profile is upload it should be called by GET requets in order to show the profile picture</li></ul><ul id="ddd6fae4-63f0-4096-be96-c666f22071be" class="bulleted-list"><li style="list-style-type:disc">Send the GET request and see if you get any 200 response, which shows the GET request is calling</li></ul><ul id="ae5b096d-2568-4add-92e3-6e83816dd073" class="bulleted-list"><li style="list-style-type:disc">Now, manipulate the POST request to see if the malicious code or payload is getting upload or not. If yes, ccheck the same path with GET request</li></ul></details></li></ul><ul id="02d551f1-a26b-444b-b2a1-1d634d8188f0" class="toggle"><li><details open=""><summary><strong>Exploiting flawed validation of file uploads</strong></summary><p id="d0f904b5-5473-47d3-ad48-b2102699cc5a" class="">In real-world scenarios, it is highly unlikely to encounter a website that lacks any form of protection against file upload attacks, as demonstrated in the previous lab. However, the presence of defense mechanisms does not guarantee their effectiveness.</p><p id="e1b896e5-d652-41fd-abd3-d5fe5a388005" class="">This section delves into the methods employed by web servers to validate and sanitize file uploads. Additionally, we explore potential vulnerabilities in these mechanisms that can be exploited to acquire a web shell, enabling remote code execution.</p><ul id="830e3e4f-c735-4116-a40b-18891ec10c2c" class="toggle"><li><details open=""><summary><strong>Flawed file type validation</strong></summary><ul id="9e16afa0-9955-4965-8061-131ff0867edf" class="bulleted-list"><li style="list-style-type:disc">For the simple HTMl form, we deals with name, address and so on with the POST request and content type of <em>application/x-www-form-url-encoded</em></li></ul><ul id="005ac0c2-d46f-4baa-a5f1-7ed445eba85a" class="bulleted-list"><li style="list-style-type:disc">If you want to send some image or PDF doc then the content-type will <em>multipart/form-data</em></li></ul><pre id="bea1a7a3-7e04-4c84-b142-2b0da4e95a1d" class="code"><code>POST /images HTTP/1.1
Host: normal-website.com
Content-Length: 12345
Content-Type: multipart/form-data; boundary=---------------------------012345678901234567890123456

---------------------------012345678901234567890123456
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;example.jpg&quot;
Content-Type: image/jpeg

[...binary content of example.jpg...]

---------------------------012345678901234567890123456
Content-Disposition: form-data; name=&quot;description&quot;

This is an interesting description of my image.

---------------------------012345678901234567890123456
Content-Disposition: form-data; name=&quot;username&quot;

wiener
---------------------------012345678901234567890123456--</code></pre><ul id="f6c98b60-23c1-4626-8a0f-151c6650b754" class="bulleted-list"><li style="list-style-type:disc">In the above code, there are separate content-disposition which is having their own content-type header which tells about the MIME type of the data that was submitted using this input</li></ul><p id="0f5024b6-bad3-44b5-9c90-eaf32308f06b" class="">+++++++++++++++++++++++++++Practical++++++++++++++++++++++++</p><h3 id="751e2064-b7f4-4975-8821-a518371bf182" class="">Steps to test Content-type restriction bypass</h3><ul id="5424c53c-060d-46ca-8d1e-9ae6f99b66f9" class="bulleted-list"><li style="list-style-type:disc">check for the upload functionality</li></ul><ul id="81dca790-4231-4b11-b228-c6ff1d6387cc" class="bulleted-list"><li style="list-style-type:disc">Upload and a file and intercept the request</li></ul><ul id="0d2c8437-8789-428c-b131-563ceaf62945" class="bulleted-list"><li style="list-style-type:disc">The main method would be POST since we are uploadng the file in database</li></ul><ul id="a695a5df-ccee-43fc-a502-275ed04be169" class="bulleted-list"><li style="list-style-type:disc">Check in the proxy history tab for the GET request, as once the profile is upload it should be called by GET requets in order to show the profile picture</li></ul><ul id="31f7f32f-68e7-4957-be78-ae2a19b5cb5d" class="bulleted-list"><li style="list-style-type:disc">Send the GET request and see if you get any 200 response, which shows the GET request is calling</li></ul><ul id="fad07c46-db13-45bc-a28b-d36df0d72b99" class="bulleted-list"><li style="list-style-type:disc">Now, manipulate the POST request to see if the malicious code or payload is getting upload or not and adding to this if there is no reflection then change the content type of the file you are uploading. If yes, check the same path with GET request</li></ul></details></li></ul></details></li></ul><ul id="90546c95-8ea4-4ec7-b29f-2a1953a979b4" class="toggle"><li><details open=""><summary><strong>Preventing file execution in user-accessible directories</strong></summary><ul id="754cc43d-0ca9-447d-b79f-9605c8264039" class="bulleted-list"><li style="list-style-type:disc">Prevention of dangerous file types is the primary defense against file upload attacks.</li></ul><ul id="01bf7f10-3701-4545-a54d-810982f3b7b9" class="bulleted-list"><li style="list-style-type:disc">A secondary defense is preventing the server from executing any slipped-through scripts.</li></ul><ul id="a98dd2b0-05ae-433b-9a9f-2fd5fd9a8e23" class="bulleted-list"><li style="list-style-type:disc">Servers typically only execute scripts with explicitly configured MIME types.</li></ul><pre id="1fe2a32b-b2e8-4554-bba7-edd3eb216f7e" class="code"><code>GET /static/exploit.php?command=id HTTP/1.1
Host: normal-website.com


HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 39

&lt;?php echo system($_GET[&#x27;command&#x27;]); ?&gt;</code></pre><ul id="7610b5fb-248b-462d-a360-b3fa42726ff2" class="bulleted-list"><li style="list-style-type:disc">In some cases, the server may return an error message or serve file contents as plain text instead of executing the script.</li></ul><ul id="7533a091-6d5c-4476-89f0-faebd8cc9147" class="bulleted-list"><li style="list-style-type:disc">This behavior can be used to leak source code but prevents the creation of a web shell.</li></ul><ul id="7aace02b-c661-476b-838b-5773aa97f978" class="bulleted-list"><li style="list-style-type:disc">Configuration for script execution often varies between directories.</li></ul><ul id="41c43754-8772-4d77-880d-accd9fc2c847" class="bulleted-list"><li style="list-style-type:disc">Directories where user-supplied files are uploaded have stricter controls compared to others.</li></ul><ul id="48883354-d001-49fc-9529-c48b48d0d7db" class="bulleted-list"><li style="list-style-type:disc">Uploading a script to a different directory not meant for user-supplied files may result in script execution by the server.</li></ul><blockquote id="f051b867-33a2-402a-b6c3-a2388bb9bebf" class="">Web servers often use the <code>filename</code> field in <code>multipart/form-data</code> requests to determine the name and location where the file should be saved.</blockquote><p id="5462969e-cc47-4f1d-911a-a41a5fc0ba14" class="">+++++++++++++++++++++++++++Practical++++++++++++++++++++++++++</p><h3 id="cf09377b-ce5a-4f92-a575-51b864617e67" class="">Setps for <strong>Web shell upload via path traversal</strong></h3><ul id="81e4fa76-21eb-4a8a-bae9-6f3213f982b6" class="bulleted-list"><li style="list-style-type:disc">You have to deal with POST and GET request</li></ul><ul id="55f8ab50-0268-412e-a0f2-ec58c6cf910d" class="bulleted-list"><li style="list-style-type:disc">First upload a picture or document where ever is possible.</li></ul><ul id="f71a26f4-fd15-4c57-a517-dc859c09f709" class="bulleted-list"><li style="list-style-type:disc">capture the POST request</li></ul><ul id="37a4e3b6-2d6b-4cf4-b5d3-922744d716b8" class="bulleted-list"><li style="list-style-type:disc">change the file type, directory, changing encoding like URL encode ityadi ityadi<figure id="96d23d78-0fdd-449c-b01f-9e3cbdb5d7e1"><a href="https://book.hacktricks.xyz/pentesting-web/file-upload" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">File Upload</div></div><div class="bookmark-href"><img src="https://1517081779-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Ficon%2FRaEPLScv7ncPye3tZ0Ae%2FHACKTRICKS-logo.svg?alt=media&amp;token=91a7779c-ca60-40b1-99a5-54981687a9f7" class="icon bookmark-icon"/>https://book.hacktricks.xyz/pentesting-web/file-upload</div></div></a></figure><p id="601fe9bb-c0a4-4ea1-bc83-3780c66067be" class="">refer this execellent cheat sheet to go and perform the file upload vulnerability</p></li></ul><ul id="80cc9f94-d361-4171-8f0f-8eb312d2300b" class="bulleted-list"><li style="list-style-type:disc">Once you successfully uploaded the file. make sure to path travser if you encoding the filesystem</li></ul><p id="b2ecfb87-b848-4fa3-aa9d-bede9db9dd6d" class="">
</p></details></li></ul><ul id="0f3f803d-91af-48c8-9fe0-fe4a956e1947" class="toggle"><li><details open=""><summary><strong>Insufficient blacklisting of dangerous file types</strong></summary><ul id="cf2d8f50-08eb-45e2-8881-79fe4ecb71c5" class="bulleted-list"><li style="list-style-type:disc">Preventing users from uploading malicious scripts is important for maintaining the security of a system.</li></ul><ul id="da5dbf5b-5f1c-41ed-bb16-4e134ee20a1b" class="bulleted-list"><li style="list-style-type:disc">Blacklisting potentially dangerous file extensions like .php is a common approach to prevent script execution.</li></ul><ul id="a6e08964-c0a9-4421-9f67-b493492f1302" class="bulleted-list"><li style="list-style-type:disc">However, blacklisting has inherent flaws and may not provide foolproof protection.</li></ul><ul id="a8b5220f-0794-4354-94d5-c032ed7cd121" class="bulleted-list"><li style="list-style-type:disc">It is difficult to identify and block every possible file extension that can be used to execute code.</li></ul><ul id="4d038d18-6165-4484-b225-0d1abed44991" class="bulleted-list"><li style="list-style-type:disc">Blacklists can be bypassed by using lesser known or alternative file extensions that are still executable.<ul id="484eb0ab-ab80-4dc8-a85d-afa9f6190be2" class="bulleted-list"><li style="list-style-type:circle">Examples of alternative file extensions that can be used to bypass blacklists include .php5, .shtml, and others.</li></ul></li></ul><ul id="a710c841-18de-46f9-b664-7b9fcc530bb9" class="bulleted-list"><li style="list-style-type:disc">Therefore, relying solely on blacklisting file extensions is not a comprehensive solution for preventing the upload of malicious scripts.</li></ul><ul id="6e5020bf-d905-40d7-bca7-1910d408548c" class="bulleted-list"><li style="list-style-type:disc">Additional security measures such as input validation, file type verification, and content scanning should be implemented to enhance security.</li></ul><ul id="a0a6ef52-9665-4f63-b54e-1ac9dabc489e" class="bulleted-list"><li style="list-style-type:disc">Regular updates and maintenance of the blacklist are necessary to keep up with emerging threats and new file extensions that can be used for malicious purposes.</li></ul><p id="d69aa81c-b0bc-44ce-9cb0-f15438af85ff" class="">+++++++++++++++++++++++++++Practical++++++++++++++++++++++++++</p><ul id="962b3094-93f5-4690-a594-1676d3b2884d" class="toggle"><li><details open=""><summary><strong>Overriding the server configuration</strong></summary><ul id="317a96ab-7b14-404d-bda5-325bd02d618f" class="bulleted-list"><li style="list-style-type:disc">Server configuration determines whether files will be executed or not.</li></ul><ul id="f6ceb3d1-cf5b-42fa-a15c-37e8b83cbbdf" class="bulleted-list"><li style="list-style-type:disc">Apache servers require specific directives in the apache2.conf file to execute PHP files.</li></ul><ul id="6aea4407-2b0b-433c-8e5f-06381797d1c1" class="bulleted-list"><li style="list-style-type:disc">Example directives for executing PHP files: 
<code>LoadModule php_module /usr/lib/apache2/modules/libphp.so and AddType application/x-httpd-php .php</code>.</li></ul><ul id="6d1b9d66-aa48-4b3a-b0b8-3e28afa79413" class="bulleted-list"><li style="list-style-type:disc">Special configuration files can be created within individual directories to override or add to global settings.</li></ul><ul id="973b16a2-1aec-47f1-8184-41719154053b" class="bulleted-list"><li style="list-style-type:disc">Apache servers load directory-specific configurations from .htaccess files if present.</li></ul><ul id="d6279bcc-0bdc-4288-abe5-3e4f2b693cb6" class="bulleted-list"><li style="list-style-type:disc">IIS servers use web.config files for directory-specific configurations.</li></ul><ul id="c292e210-2761-4ce4-a1d3-eac37619f9a2" class="bulleted-list"><li style="list-style-type:disc">Example directive in a web.config file: <pre id="68908666-f5b3-467c-86bb-3089d0f4c9c8" class="code"><code>&lt;staticContent&gt;
	&lt;mimeMap fileExtension=&quot;.json&quot; mimeType=&quot;application/json&quot; /&gt;
&lt;/staticContent&gt;</code></pre></li></ul><ul id="5ad26b44-8c62-4ca7-b35f-dc4b108ce020" class="bulleted-list"><li style="list-style-type:disc">Configuration files are not normally accessible via HTTP requests.</li></ul><ul id="5009f4e2-fe8c-497f-928e-9c8f698c4197" class="bulleted-list"><li style="list-style-type:disc">In some cases, servers may fail to prevent the upload of malicious configuration files.</li></ul><ul id="f240cf4a-08fb-4fec-bbd7-a007c9ef20dc" class="bulleted-list"><li style="list-style-type:disc">Uploading a custom configuration file may allow mapping of an arbitrary file extension to an executable MIME type.</li></ul><ul id="2dbf1611-da75-4605-acab-dc155077301b" class="bulleted-list"><li style="list-style-type:disc">This bypasses blacklisting of file extensions and allows execution of potentially malicious files.</li></ul><ul id="619d32c3-e0ab-4e81-974b-9f2dbc4f7fa9" class="bulleted-list"><li style="list-style-type:disc">It is important for server administrators to secure their configurations and prevent unauthorized access or upload of configuration files.</li></ul><h3 id="478bc50d-dada-4ef7-b09e-c366df1f92e6" class=""><strong>Steps for Web shell upload via extension blacklist bypass</strong></h3><ul id="aad22603-7c0b-4a24-b987-b722e7d9197f" class="bulleted-list"><li style="list-style-type:disc">Capture the POST and GET request</li></ul><ul id="d2053601-56b8-4a17-85b1-ea9120079657" class="bulleted-list"><li style="list-style-type:disc">Change the filename with php extension and put the payload in it</li></ul><ul id="0f9e6b92-7085-458b-a398-48381c5717a0" class="bulleted-list"><li style="list-style-type:disc">Once you send the POST and call the GET request, you’ll see there is a error called “you cannot upload such type of file”</li></ul><ul id="d9222328-d71c-4216-beb5-53dc3bba065f" class="bulleted-list"><li style="list-style-type:disc">Now, look for the other information, if request is showing the server information then try to manipulate the server related configuration files

If the server is apache then do this<ul id="67698bd9-a67a-412e-b231-5573b0d7f46b" class="bulleted-list"><li style="list-style-type:circle">APACHE - .htaccess</li></ul><ul id="fda7ed21-3d57-48e5-af30-26b9d55795e2" class="bulleted-list"><li style="list-style-type:circle">content-type to text/plain</li></ul><ul id="8253b658-46ec-4adb-ae77-2ab3a1ee450a" class="bulleted-list"><li style="list-style-type:circle"><code>AddType application/x-httpd-php .l33t</code><p id="b65d59ef-b692-4b5a-b4dc-71d32a9d368a" class=""><code>(</code>This maps an arbitrary extension (<code>.l33t</code>) to the executable MIME type <code>application/x-httpd-php</code>. As the server uses the <code>mod_php</code> module, it knows how to handle this already.)</p></li></ul></li></ul><ul id="49d13850-c2c0-42ef-ad9b-d45c9f776db9" class="bulleted-list"><li style="list-style-type:disc">Once you done updating the content of the file .htaccess, then repeat the process of adding the payload and send the POST request first and then call the GET request to show the content of the file</li></ul></details></li></ul><ul id="4c6be454-c54a-4078-a5b6-247b5d9da5ff" class="toggle"><li><details open=""><summary><strong>Obfuscating file extension</strong></summary><ul id="c1c8214d-7699-4141-ac2d-5ad216c790a2" class="bulleted-list"><li style="list-style-type:disc">Blacklists can be bypassed using classic obfuscation techniques.</li></ul><ul id="0dbdd32f-d474-48db-a521-4d03c0cae94c" class="bulleted-list"><li style="list-style-type:disc">Case sensitivity can be exploited by using file extensions like exploit.pHp.</li></ul><ul id="abc0a9e1-270d-4266-9fc7-afaf9b82bcd1" class="bulleted-list"><li style="list-style-type:disc">Discrepancies between case sensitivity in validation code and mapping file extension to MIME type can allow malicious files to pass validation.</li></ul><ul id="40dba4e9-6435-499b-a039-c3d8acfea84c" class="bulleted-list"><li style="list-style-type:disc">Multiple extensions can confuse the parsing algorithm, e.g., exploit.php.jpg.</li></ul><ul id="072dde3c-a09c-440a-8665-f69614fb23de" class="bulleted-list"><li style="list-style-type:disc">Trailing characters like whitespaces or dots can be ignored or stripped, allowing malicious files to pass, e.g., exploit.php.</li></ul><ul id="c14fa3a3-b0b7-46ea-9fb4-d2df581399dd" class="bulleted-list"><li style="list-style-type:disc">URL encoding or double URL encoding for dots, slashes, etc., can bypass validation if not properly decoded, e.g., exploit%2Ephp.</li></ul><ul id="d7083ade-1022-48ca-b71f-13daca130dd6" class="bulleted-list"><li style="list-style-type:disc">Semicolons or URL-encoded null bytes before the file extension can cause discrepancies in high-level language validation and lower-level server processing, e.g., exploit.asp;.jpg or exploit.asp%00.jpg.</li></ul><ul id="74bf385c-9258-4930-9a20-8f9022a82ec9" class="bulleted-list"><li style="list-style-type:disc">Multibyte unicode characters may be converted to null bytes or dots after conversion, e.g., xC0 x2E, xC4 xAE or xC0 xAE.</li></ul><ul id="095424cd-6279-4f01-acd6-88ece0ec502e" class="bulleted-list"><li style="list-style-type:disc">Stripping or replacing dangerous extensions may not be applied recursively, allowing valid file extensions to remain after removing prohibited strings.</li></ul><ul id="8b339387-1850-49fc-8e5e-6e1d8f07e403" class="bulleted-list"><li style="list-style-type:disc">Proper consideration of file extension validation and handling is crucial to prevent malicious file uploads.</li></ul><pre id="376ff598-3238-4dae-a49c-acdf073c0b72" class="code"><code>exploit.p.phphp</code></pre><ul id="2e1b302b-8bb9-4c8b-8af5-9e575d6648cc" class="bulleted-list"><li style="list-style-type:disc">This is just a small selection of the many ways it&#x27;s possible to obfuscate file extensions.</li></ul><h3 id="8fb4751c-ac30-4c03-81e6-b422a95fd42b" class="">Steps to test the obfuscating file extension upload vulnerability</h3><ul id="b8a5a3d8-4d2b-4a0d-8043-2df2b6c40cb6" class="bulleted-list"><li style="list-style-type:disc">Repeat the same steps for POST and GET request</li></ul><ul id="9ee4de5f-d934-4db3-b0fc-34e7dacdfade" class="bulleted-list"><li style="list-style-type:disc">In the POST Request, add the URL encoded null byte <p id="5e14c35f-50bd-40fb-a08c-9b8cf6080186" class=""><code>filename=&quot;test.php%00.jpg&quot;</code> which signifies <code>filename=”test.php .jpg”</code></p></li></ul><ul id="56066d2b-7938-4147-8f3e-1638494484e5" class="bulleted-list"><li style="list-style-type:disc">Now send the crafted through POST requets and call the GET request for the file content or the payload content</li></ul></details></li></ul><ul id="76f90a92-96c9-4e62-8744-e2cf6ec560b0" class="toggle"><li><details open=""><summary><strong>Flawed validation of the file&#x27;s contents</strong></summary><ul id="bdb74eec-5057-47e1-bc0a-4e193defa8d4" class="bulleted-list"><li style="list-style-type:disc">First follow this link for the first header informatio of each and every file type</li></ul><figure id="651a0ca9-5bc3-4184-905a-982ecd802b8e"><a href="https://en.wikipedia.org/wiki/List_of_file_signatures" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">List of file signatures</div><div class="bookmark-description">This is a list of file signatures, data used to identify or verify the content of a file. Such signatures are also known as magic numbers or Magic Bytes.</div></div><div class="bookmark-href"><img src="https://en.wikipedia.org/static/apple-touch/wikipedia.png" class="icon bookmark-icon"/>https://en.wikipedia.org/wiki/List_of_file_signatures</div></div></a></figure><ul id="9e56dc6d-a1cb-4213-95da-aa99b25704a1" class="bulleted-list"><li style="list-style-type:disc">Rather than blindly trusting the Content-Type specified in a request, secure servers employ verification techniques to confirm that the file contents match the expected type.</li></ul><ul id="fb671f8e-3cb5-4112-b8a6-ed174b780f4d" class="bulleted-list"><li style="list-style-type:disc">When dealing with image uploads, servers can examine intrinsic properties like dimensions to distinguish legitimate images from potential malicious files, such as PHP scripts that lack dimensions.</li></ul><ul id="743ba799-2936-4c7d-abbc-e4e19b39606c" class="bulleted-list"><li style="list-style-type:disc">Certain file types have distinct byte sequences in their header or footer that serve as unique signatures, enabling servers to validate the expected type. For instance, the bytes FF D8 FF are always found at the beginning of JPEG files.</li></ul><ul id="42f37f88-4d10-4d39-8b30-a94d010734d7" class="bulleted-list"><li style="list-style-type:disc">While verifying file contents using byte sequences is a more robust approach, it is not infallible.</li></ul><ul id="a6b4d495-cd05-48f5-95be-41b151d0bcbb" class="bulleted-list"><li style="list-style-type:disc">Sophisticated tools like ExifTool can create polyglot JPEG files that embed malicious code within their metadata, evading traditional file type validation.</li></ul><ul id="705de6cc-c86b-4b4e-ba77-27d56d3293ef" class="bulleted-list"><li style="list-style-type:disc">To enhance security, additional measures like content scanning and thorough input validation should be implemented alongside file type verification to mitigate the risks associated with malicious uploads.</li></ul><h3 id="a7740a14-457c-45bb-a1c4-51237922859f" class="">Steps for remote code execution via polyglot web shell upload</h3><ul id="926ce1aa-8e9b-4893-b346-1220d7d1edc7" class="bulleted-list"><li style="list-style-type:disc">If any of the above steps are not working, then go with this</li></ul><p id="e99639dd-8cd6-4c2c-928f-fd5f7a102e84" class=""><code>exiftool -Comment=&quot;&lt;?php echo &#x27;START &#x27; . file_get_contents(&#x27;/home/carlos/secret&#x27;) . &#x27; END&#x27;; ?&gt;&quot; &lt;YOUR-INPUT-IMAGE&gt;.jpg -o polyglot.php</code></p><ul id="ef6a165e-92ed-47ad-a3ba-583fdee54c58" class="bulleted-list"><li style="list-style-type:disc">here START and END will represent the marking of the code which will reflect back if the payload got executed</li></ul><p id="81b1c74f-c5e1-4d44-a78b-e325788fe624" class="">
</p></details></li></ul></details></li></ul><ul id="f4238f1c-ddaf-4164-b01b-4017696df24a" class="toggle"><li><details open=""><summary><strong>Exploiting file upload race conditions</strong></summary><ul id="5b6d18ea-a844-4941-b8c5-9bd0c5c96780" class="bulleted-list"><li style="list-style-type:disc">Modern frameworks employ robust measures to protect against attacks involving file uploads.</li></ul><ul id="03587a78-df34-404e-a8b1-82c6ff639f50" class="bulleted-list"><li style="list-style-type:disc">Files are typically uploaded to a temporary, sandboxed directory instead of directly to the intended destination on the filesystem.</li></ul><ul id="94d3d1e4-1600-4c57-8bad-0664f620ca02" class="bulleted-list"><li style="list-style-type:disc">The names of uploaded files are randomized to prevent overwriting existing files.</li></ul><ul id="97449517-5b3e-4665-825f-44398be99854" class="bulleted-list"><li style="list-style-type:disc">Validation is performed on the temporary file before transferring it to its final destination.</li></ul><ul id="84716b3d-1ed7-4dcf-a69f-dd2aa79e08d8" class="bulleted-list"><li style="list-style-type:disc">Independent file upload processing implemented by developers can bypass framework-level protections and introduce race conditions.</li></ul><ul id="6e20ca85-a455-4ed8-9fd1-318e841c89be" class="bulleted-list"><li style="list-style-type:disc">Some websites upload files directly to the main filesystem and remove them if they fail validation, relying on external tools like anti-virus software for malware checks.</li></ul><ul id="753caa15-ae64-44c1-9a10-46f1f2f038f7" class="bulleted-list"><li style="list-style-type:disc">Even during the short time the file exists on the server, attackers can potentially execute it.</li></ul><ul id="14474d4a-af31-4e08-904e-f7cc03b3c9bc" class="bulleted-list"><li style="list-style-type:disc">Detecting these vulnerabilities during blackbox testing can be challenging due to their subtle nature, often requiring access to relevant source code for effective detection.</li></ul><h3 id="1d9783fe-e109-4086-afa9-53d6b4bdef54" class="">Steps for <strong>Web shell upload via race condition</strong></h3><ul id="d04b2270-dbe9-45e3-aa1f-d223f6124af3" class="bulleted-list"><li style="list-style-type:disc">capture the POST requets where you upload the file</li></ul><ul id="19370673-8633-4ab5-b49b-82240f34f938" class="bulleted-list"><li style="list-style-type:disc">capture the GET request where you executing the file</li></ul><ul id="d22dde85-0110-4f88-8205-6285650cf8d9" class="bulleted-list"><li style="list-style-type:disc">now, copy and paste the POST and GET content and send the same into turbo intruder by selecting the scrtipt you want to execute for</li></ul><p id="d88506de-1e66-489e-bbb0-a508074d8338" class="">
</p></details></li></ul><ul id="ecb7530c-3547-47c8-a856-78e7a1e2c81d" class="toggle"><li><details open=""><summary><strong>Race conditions in URL-based file uploads</strong></summary><ul id="31238657-faba-4193-ace0-1a18ef4aef41" class="bulleted-list"><li style="list-style-type:disc">Race conditions can also occur in functions that allow file uploads via a URL.</li></ul><ul id="54bdc27d-3c9f-4556-8814-6f01f514061f" class="bulleted-list"><li style="list-style-type:disc">Servers need to fetch the file from the internet and create a local copy before performing validation.</li></ul><ul id="4b29c79c-9ff1-4d0e-8817-f9ce0c5ae805" class="bulleted-list"><li style="list-style-type:disc">Frameworks&#x27; built-in mechanisms for secure file validation cannot be utilized in URL-based uploads.</li></ul><ul id="bcc02ce5-bf04-48f0-b754-407ef742d164" class="bulleted-list"><li style="list-style-type:disc">Developers may manually create their own processes for temporarily storing and validating the file, which may be less secure.</li></ul><ul id="373c3c69-1df1-437b-be7d-a983e5990bc7" class="bulleted-list"><li style="list-style-type:disc">Using a temporary directory with a randomized name can mitigate race conditions and prevent attackers from exploiting them.</li></ul><ul id="c30f1689-c8e7-4026-a89c-58dc09701362" class="bulleted-list"><li style="list-style-type:disc">However, if the randomized directory name is generated using predictable functions like PHP&#x27;s uniqid(), it can be brute-forced by attackers.</li></ul><ul id="f590c2e1-dca5-4b5c-b8da-212e28158574" class="bulleted-list"><li style="list-style-type:disc">Extending the processing time of the file can make attacks easier by increasing the window for brute-forcing the directory name.</li></ul><ul id="136ee389-e7c6-425b-9608-dadd0fc3ca1a" class="bulleted-list"><li style="list-style-type:disc">Uploading a larger file can increase processing time, allowing for potential exploitation.</li></ul><ul id="40c529e8-10e0-4c79-8a88-b2a93a95ca17" class="bulleted-list"><li style="list-style-type:disc">Chunk-based processing can be exploited by creating a malicious file with the payload at the beginning and a large number of padding bytes afterwards.</li></ul></details></li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3">File upload vulnerabilities can be exploited in ways other than remote code execution.</summary><div class="indented"><ul id="bc66c402-9ec9-4f60-b461-6de5d21d1668" class="bulleted-list"><li style="list-style-type:disc">Uploading malicious client-side scripts can lead to client-side attacks, such as stored XSS payloads using &lt;script&gt; tags in HTML files or SVG images.</li></ul><ul id="ebb305a1-34a5-4dfa-b2f9-920e81745a5a" class="bulleted-list"><li style="list-style-type:disc">If the uploaded file appears on a page visited by other users, their browsers will execute the script, but same-origin policy restrictions apply.</li></ul><ul id="4ca8a7d3-a0c8-4ab7-9784-7e0c178b0464" class="bulleted-list"><li style="list-style-type:disc">Exploiting vulnerabilities in the parsing or processing of uploaded file formats, such as XML-based files like Microsoft Office .doc or .xls files, can be attempted as a last resort.</li></ul><ul id="518fa5f9-b45c-422d-8584-145396e872c8" class="bulleted-list"><li style="list-style-type:disc">Some web servers may support PUT requests, which can provide an alternative means of uploading malicious files if proper defenses are not in place.</li></ul><ul id="c83e30dc-1a29-42d7-8221-ee42efaf8e55" class="bulleted-list"><li style="list-style-type:disc">Testing endpoints with OPTIONS requests can help identify if the PUT method is supported.</li></ul><ul id="c840e1b2-dbf6-4621-adeb-22dfb3b5026c" class="bulleted-list"><li style="list-style-type:disc">Example PUT request:<pre id="3e7ff7fc-e4ac-4688-ba0f-d6945ff08328" class="code"><code>PUT /images/exploit.php HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-httpd-php
Content-Length: 49

&lt;?php echo file_get_contents(&#x27;/path/to/file&#x27;); ?&gt;</code></pre></li></ul><ul id="dbd8e1cd-b995-45b0-80bd-4ab17f842fb5" class="bulleted-list"><li style="list-style-type:disc">Caution: Be mindful of legal and ethical considerations when conducting security testing or assessments.</li></ul></div></details><details open=""><summary style="font-weight:600;font-size:1.25em;line-height:1.3">Mitigations</summary><div class="indented"><ol type="1" id="d67fa0f4-204f-4d2f-9ab0-0634d5ebe2e7" class="numbered-list" start="1"><li>Whitelist Approach:<ul id="7deda698-99d5-49e6-aba8-953256629310" class="bulleted-list"><li style="list-style-type:disc">Maintain a predefined list of permitted file extensions that your application supports.</li></ul><ul id="d6fde963-abbd-4123-976a-65af67102108" class="bulleted-list"><li style="list-style-type:disc">Check the file extension of the uploaded file against the whitelist to ensure it matches an allowed extension. Reject files with unrecognized or prohibited extensions.</li></ul></li></ol><ol type="1" id="6689383d-c625-4afe-b80d-1cd03afa5090" class="numbered-list" start="2"><li>Directory Traversal Prevention:<ul id="c0d1a3c5-af34-4745-8daa-d22abba4c89f" class="bulleted-list"><li style="list-style-type:disc">Validate the filename to ensure it does not contain any special characters or sequences that may be interpreted as directory traversal attempts.</li></ul><ul id="545a400f-4e4e-491c-94d7-d1426652ffaa" class="bulleted-list"><li style="list-style-type:disc">Implement a sanitization function to remove or replace any potentially dangerous characters or sequences in the filename.</li></ul></li></ol><ol type="1" id="26433c64-c9a7-4814-9ddd-1c7f266ea642" class="numbered-list" start="3"><li>Filename Collision Avoidance:<ul id="ec218aa8-c833-4333-868f-4b21038fe2c2" class="bulleted-list"><li style="list-style-type:disc">Generate a unique filename for each uploaded file to prevent collisions and overwriting of existing files.</li></ul><ul id="6965a521-7c94-4f9d-b9af-1d8183739902" class="bulleted-list"><li style="list-style-type:disc">You can use a combination of techniques such as appending a timestamp, generating a random string, or using a unique identifier like a UUID to create unique filenames.</li></ul></li></ol><ol type="1" id="7c873bca-41d0-4efa-ac81-f4d354e65309" class="numbered-list" start="4"><li>Temporarily Store Files:<ul id="bbded1e7-d931-4b00-bfff-961a239e952d" class="bulleted-list"><li style="list-style-type:disc">Create a temporary directory on the server where uploaded files are initially stored.</li></ul><ul id="44b6a92f-f892-485f-a204-bcc155115ddd" class="bulleted-list"><li style="list-style-type:disc">Perform validation and security checks on the file while it resides in the temporary directory.</li></ul><ul id="650fcc3d-27e0-444d-9a21-ec75248bb9fe" class="bulleted-list"><li style="list-style-type:disc">Only move the file to the permanent filesystem once it has passed all validation checks and is deemed safe.</li></ul></li></ol><ol type="1" id="26b15beb-4ed9-448c-b004-af3743004a02" class="numbered-list" start="5"><li>Leveraging Established Frameworks:<ul id="f5499b8f-2cda-44c6-949b-34b751d178fd" class="bulleted-list"><li style="list-style-type:disc">Research and choose a reputable and widely-used framework that provides robust file upload functionality.</li></ul><ul id="af269ea4-4af0-416a-9d31-5312ad1668c0" class="bulleted-list"><li style="list-style-type:disc">Follow the framework&#x27;s documentation and best practices for handling file uploads, including validation and security measures.</li></ul><ul id="2b9731fa-b693-453b-b7c7-89c14fccc536" class="bulleted-list"><li style="list-style-type:disc">Utilize the built-in features of the framework for file handling and processing, as they are likely to have undergone extensive testing and security reviews.</li></ul></li></ol><ol type="1" id="331bcd10-c15f-4daf-a134-4d7ddf6d388b" class="numbered-list" start="6"><li>Regular Updates and Patching:<ul id="9c4eabeb-c133-42ba-9690-cc37012b90b7" class="bulleted-list"><li style="list-style-type:disc">Stay up-to-date with the latest releases and security patches of the chosen framework.</li></ul><ul id="51bbcabd-5867-4054-8948-fcd9478f732b" class="bulleted-list"><li style="list-style-type:disc">Monitor the official channels for security advisories related to the framework and promptly apply any necessary updates.</li></ul><ul id="b5f861cb-ef94-405c-9b60-88c479a0bd1c" class="bulleted-list"><li style="list-style-type:disc">Regularly review and update your application&#x27;s dependencies, including the chosen framework, to benefit from the latest security enhancements and bug fixes.</li></ul><pre id="ddda488d-1988-4a1c-a1e0-fc33e985d4d6" class="code"><code>&lt;?php
// Whitelist of permitted file extensions
$allowedExtensions = [&#x27;jpg&#x27;, &#x27;jpeg&#x27;, &#x27;png&#x27;];

// Function to sanitize filename and prevent directory traversal
function sanitizeFilename($filename) {
    // Remove any characters that may be interpreted as directory traversal
    $sanitizedFilename = str_replace([&#x27;../&#x27;, &#x27;./&#x27;], &#x27;&#x27;, $filename);
    return $sanitizedFilename;
}

// Function to generate a unique filename
function generateUniqueFilename($originalFilename) {
    $extension = pathinfo($originalFilename, PATHINFO_EXTENSION);
    $uniqueFilename = uniqid() . &#x27;_&#x27; . $extension;
    return $uniqueFilename;
}

// Function to validate file extension against whitelist
function isAllowedExtension($extension) {
    global $allowedExtensions;
    return in_array($extension, $allowedExtensions);
}

// Temporary directory for storing uploaded files
$tempDirectory = &#x27;/path/to/temp_directory/&#x27;;

// Process file upload
if ($_SERVER[&#x27;REQUEST_METHOD&#x27;] === &#x27;POST&#x27;) {
    $uploadedFile = $_FILES[&#x27;file&#x27;];

    // Sanitize the filename to prevent directory traversal
    $sanitizedFilename = sanitizeFilename($uploadedFile[&#x27;name&#x27;]);

    // Generate a unique filename
    $uniqueFilename = generateUniqueFilename($sanitizedFilename);

    // Validate file extension against whitelist
    $extension = pathinfo($uniqueFilename, PATHINFO_EXTENSION);
    if (!isAllowedExtension($extension)) {
        die(&quot;Invalid file extension&quot;);
    }

    // Move the uploaded file to the temporary directory
    $tempFilePath = $tempDirectory . $uniqueFilename;
    if (move_uploaded_file($uploadedFile[&#x27;tmp_name&#x27;], $tempFilePath)) {
        // Perform additional validation and processing on the file
        // ...

        // If the file is deemed safe, move it to the permanent filesystem
        $destinationDirectory = &#x27;/path/to/destination_directory/&#x27;;
        $finalFilePath = $destinationDirectory . $uniqueFilename;
        if (rename($tempFilePath, $finalFilePath)) {
            echo &quot;File uploaded successfully!&quot;;
        } else {
            echo &quot;Failed to move the file to its destination.&quot;;
        }
    } else {
        echo &quot;Error uploading the file.&quot;;
    }
}
?&gt;</code></pre></li></ol></div></details></div></article></body></html>